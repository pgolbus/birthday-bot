name: "Push to docker hub"

on:
  workflow_call:
    inputs:
      version:
        required: true
        type: string

jobs:
  tests:
    name: tests
    uses: ./.github/workflows/tests.yaml

  push:
    runs-on: ubuntu-latest
    name: push
    needs: [tests]
    steps:
      - name: checkout
        uses: actions/checkout@v3
      - name: login
        uses: docker/login-action@v1
        with:
          username: ${{secrets.DOCKER_USERNAME}}
          password: ${{secrets.DOCKER_PASSWORD}}
      - name: build
        run: docker build . --file Dockerfile --tag pgolbus2/cs411-birthday-bot:${{ github.event.inputs.version }}
      - name: push
        run: docker push ${{secrets.DOCKER_USERNAME}}/cs411-birthday-bot:${{ github.event.inputs.version }}